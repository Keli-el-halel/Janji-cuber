<html>
<head>
<title>webcube</title>
</head>
<body>

<center><div id="x"></div></center>

<script>
document.getElementById("x").appendChild(getCubeSVG({}))

// Created by Josef Jelinek <josef.jelinek@gmail.com> [http://rubikscube.info]
// Public Domain - use for whatever and however you please at your own risk

function getCubeSVG(options) {
    "use strict"

    const side = options.side || options.n || 3
    const size = options.size || 480
    const b = options.b || 25
    const d = options.d || 5
    const bd = options.bd || d
    const facelets = options.facelets || options.fl || options.stickers || "yyyyyyyyyrrrrrrrrrggggggggg"
    const bl = options.bl
    const al = options.al
    const rotx = options.rx || 40
    const roty = options.ry || 32
    const anglex = rotx / 200.0 * Math.PI
    const angley = roty / -200.0 * Math.PI
    const axis = {x: [1, 0, 0], y: [0, 1, 0], z: [0, 0, -1]}
    const solid = bl === undefined || bd === d

    const c = {
        r: "#D00000",
        o: "#EE8800",
        b: "#2040D0",
        g: "#11AA00",
        w: "#FFFFFF",
        y: "#FFFF00",
        l: solid ? "#DDDDDD" : alpha(0.6, "#DDDDDD"),
        d: solid ? "#555555" : alpha(0.6, "#555555"),
        x: solid ? "#999999" : alpha(0.6, "#999999"),
        n: alpha(0, "#999999"),
        k: "#111111",
        a: "#FFFFDD",
        c: "#0099FF",
        p: "#FF99CC",
        m: "#FF0099",
    }

    const bc = [
        solid ? "#010101" : alpha(0.1, "#010101"),
        solid ? "#090909" : alpha(0.1, "#090909"),
        solid ? "#050505" : alpha(0.1, "#050505"),
    ]

    const arrowPoints = {
        u: [{x: -2, y: 2}, {x: 0, y: 1}, {x: 2, y: 2}, {x: 0, y: -2}],
        d: [{x: -2, y: -2}, {x: 0, y: -1}, {x: 2, y: -2}, {x: 0, y: 2}],
        r: [{x: -2, y: -2}, {x: -1, y: 0}, {x: -2, y: 2}, {x: 2, y: 0}],
        l: [{x: 2, y: -2}, {x: 1, y: 0}, {x: 2, y: 2}, {x: -2, y: 0}],
    }

    const squarePoints = [
        {w: {x: 0, y: 0}, b: {x: 1, y: 1}},
        {w: {x: 1, y: 0}, b: {x: -1, y: 1}},
        {w: {x: 1, y: 1}, b: {x: -1, y: -1}},
        {w: {x: 0, y: 1}, b: {x: 1, y: -1}},
    ]

    const svgNS = "http://www.w3.org/2000/svg"
    const svg = document.createElementNS(svgNS, "svg")
    svg.setAttribute("width", String(size))
    svg.setAttribute("height", String(size))
    svg.setAttribute("viewBox", "0 0 1 1")

    if (bl !== undefined) {
        if (bd === d) {
            square(3, -0.5, -0.5, 0.5, 1, 0, bc[0]) // D
            square(4, -0.5, -0.5, 0.5, 1, 0, bc[1]) // B
            square(5, -0.5, -0.5, 0.5, 1, 0, bc[2]) // L
        }

        for (let face = 0; face < 3; face += 1) {
            for (let i = 0; i < side; i += 1) {
                for (let j = 0; j < side; j += 1) {
                    const facelet = facelets.charAt((face * side + i) * side + j)
                    const color = c[facelet]
                    const x = j / side - 0.5
                    const y = i / side - 0.5
                    const z = 0.5 + bd / 1000
                    const points = square(face + 3, x, y, z, 1 / side, b / 1000)
                    if (facelet === "x") {
                        polygon(points, color, "#666")
                    } else {
                        polygon(points, color)
                    }
                }
            }
        }
    }

    polygon(square(0, -0.5, -0.5, 0.5, 1, 0), bc[0]) // U
    polygon(square(1, -0.5, -0.5, 0.5, 1, 0), bc[1]) // F
    polygon(square(2, -0.5, -0.5, 0.5, 1, 0), bc[2]) // R

    for (let face = 0; face < 3; face += 1) {
        for (let i = 0; i < side; i += 1) {
            for (let j = 0; j < side; j += 1) {
                const facelet = facelets.charAt((face * side + i) * side + j)
                const color = c[facelet]
                const x = j / side - 0.5
                const y = i / side - 0.5
                const z = 0.5 + d / 1000
                const points = square(face, x, y, z, 1 / side, b / 1000)
                if (bl !== undefined && facelet === "x") {
                    polygon(points, color, "#666")
                } else {
                    polygon(points, color)
                }
                if (al !== undefined) {
                    const dir = al.charAt((face * side + i) * side + j);
                    if (dir === "u" || dir === "r" || dir === "d" || dir === "l") {
                        const w = 1 / side
                        const x = j * w - 0.5 + w / 2
                        const y = i * w - 0.5 + w / 2
                        const z = 0.5 + d / 1000
                        const points = arrowPoints[dir]
                            .map(p => project(face, x + p.x * w / 4, y + p.y * w / 4, z))
                        polygon(points.join(" "), "#000")
                    }
                }
            }
        }
    }

    return svg

    function polygon(points, color, outline) {
        const e = document.createElementNS(svgNS, "polygon");
        e.setAttribute("points", points)
        e.setAttribute("fill", color)
        if (outline) {
            e.setAttribute("stroke", outline)
            e.setAttribute("stroke-width", "0.5")
        }
        svg.appendChild(e)
    }

    function square(face, x, y, z, w, b) {
        const points = squarePoints
            .map(p => project(face, x + p.w.x * w + p.b.x * b, y + p.w.y * w + p.b.y * b, z))
        return points.join(" ")
    }

    function project(face, x, y, z) {
        const t = [
            [x, -z, -y], // U
            [x, y, -z], // F
            [z, y, x], // R
            [x, z, -y], // D
            [x, y, z], // B
            [-z, y, x], // L
        ]
        const rx = rot(t[face], axis.x)
        const ry = rot(t[face], axis.y)
        const rz = rot(t[face], axis.z)
        const sx = outcoord(rx / (1.0 - 0.3 * rz))
        const sy = outcoord(ry / (1.0 - 0.3 * rz))
        return sx + "," + sy
    }

    function outcoord(coord) {
        return (0.5 + 0.54 * coord).toFixed(6)
    }

    function rot(vec, axis) {
        const ry = rotu(axis[1], axis[2], angley)
        const rz0 = rotv(axis[1], axis[2], angley)
        const rx = rotu(axis[0], rz0, anglex)
        const rz = rotv(axis[0], rz0, anglex)
        return vec[0] * rx + vec[1] * ry + vec[2] * rz
    }

    function rotu(u, v, a) {
        return u * Math.cos(a) - v * Math.sin(a)
    }

    function rotv(u, v, a) {
        return u * Math.sin(a) + v * Math.cos(a)
    }

    function alpha(a, color) {
        const r = parseInt(color.slice(1, 3), 16)
        const g = parseInt(color.slice(3, 5), 16)
        const b = parseInt(color.slice(5, 7), 16)
        return "rbga(" + r + "," + g + "," + b + "," + a + ")"
    }
}
</script>
